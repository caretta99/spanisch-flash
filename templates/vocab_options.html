{% extends "base.html" %}

{% block title %}Vocabulary Quiz Options - Jona's Spanish Quiz{% endblock %}

{% block content %}
<div class="options-page">
    <h2>Vocabulary Quiz Options</h2>
    
    <form method="POST" action="{{ url_for('vocab_start_quiz') }}" class="options-form">
        <div class="form-sections-grid">
            <div class="form-section">
                <div class="section-header">
                    <h3>Select Vocabulary Sets</h3>
                    <div class="select-all-buttons">
                        <button type="button" class="btn btn-small btn-select-all" onclick="selectAllVocabSets()">Select All</button>
                        <button type="button" class="btn btn-small btn-deselect-all" onclick="deselectAllVocabSets()">Deselect All</button>
                    </div>
                </div>
                <div class="checkbox-group vocab-sets">
                    {% for set_key, set_name, word_count in vocab_sets %}
                    <label class="checkbox-label">
                        <input type="checkbox" name="vocab_sets" value="{{ set_key }}" 
                               {% if set_key in saved_prefs.selected_vocab_sets %}checked{% endif %}>
                        <span>{{ set_name }} ({{ word_count }})</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
            
            <div class="form-section">
                <h3>Translation Direction</h3>
                <div class="translation-note">
                    <p><strong>Note / Hinweis:</strong></p>
                    <p>Translations are in the context of their usage, not general. / Übersetzungen sind im Kontext ihrer Verwendung, nicht allgemein.</p>
                </div>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="direction" value="spanish_to_german" 
                               {% if saved_prefs.direction == 'spanish_to_german' %}checked{% endif %}>
                        <span>Spanish → German</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="direction" value="spanish_to_english" 
                               {% if saved_prefs.direction == 'spanish_to_english' %}checked{% endif %}>
                        <span>Spanish → English</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="direction" value="german_to_spanish" 
                               {% if saved_prefs.direction == 'german_to_spanish' %}checked{% endif %}>
                        <span>German → Spanish</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="direction" value="english_to_spanish" 
                               {% if saved_prefs.direction == 'english_to_spanish' %}checked{% endif %}>
                        <span>English → Spanish</span>
                    </label>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Contest Mode (Optional)</h3>
                <div class="contestant-section">
                    <div class="contestant-header">
                        <label>Contestant Names:</label>
                        <div class="contestant-buttons">
                            <button type="button" class="btn btn-small btn-select-all" onclick="addContestantBox()">Add Contestant</button>
                        </div>
                    </div>
                    <div id="contestant-inputs" class="contestant-inputs">
                        {% if saved_prefs.contestants %}
                            {% for contestant in saved_prefs.contestants %}
                            <div class="contestant-input-wrapper">
                                <input type="text" name="contestants" class="contestant-input" 
                                       value="{{ contestant }}" placeholder="Contestant {{ loop.index }}">
                                <button type="button" class="btn-remove-contestant" onclick="removeContestantBox(this)" 
                                        {% if saved_prefs.contestants|length <= 2 %}style="display: none;"{% endif %}>×</button>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="contestant-input-wrapper">
                                <input type="text" name="contestants" class="contestant-input" placeholder="Contestant 1">
                                <button type="button" class="btn-remove-contestant" onclick="removeContestantBox(this)" style="display: none;">×</button>
                            </div>
                            <div class="contestant-input-wrapper">
                                <input type="text" name="contestants" class="contestant-input" placeholder="Contestant 2">
                                <button type="button" class="btn-remove-contestant" onclick="removeContestantBox(this)" style="display: none;">×</button>
                            </div>
                        {% endif %}
                    </div>
                    <p class="contestant-hint">Leave empty to disable contest mode</p>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Quiz Settings</h3>
                <div class="input-group">
                    <label for="seconds_per_question">Seconds per question:</label>
                    <input type="number" id="seconds_per_question" name="seconds_per_question" 
                           value="{{ saved_prefs.seconds_per_question }}" min="1" max="60" required>
                </div>
                <div class="input-group">
                    <label for="seconds_per_answer">Seconds per answer:</label>
                    <input type="number" id="seconds_per_answer" name="seconds_per_answer" 
                           value="{{ saved_prefs.seconds_per_answer }}" min="1" max="60" required>
                </div>
                <div class="input-group">
                    <label for="num_questions">Number of questions:</label>
                    <input type="number" id="num_questions" name="num_questions" 
                           value="{{ saved_prefs.num_questions }}" min="1" max="100" required>
                </div>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Start Quiz</button>
            <button type="button" class="btn btn-secondary" onclick="saveAndReturnToMain()">Return to Main</button>
        </div>
    </form>
</div>

<script>
function selectAllVocabSets() {
    const checkboxes = document.querySelectorAll('input[name="vocab_sets"]');
    checkboxes.forEach(checkbox => checkbox.checked = true);
}

function deselectAllVocabSets() {
    const checkboxes = document.querySelectorAll('input[name="vocab_sets"]');
    checkboxes.forEach(checkbox => checkbox.checked = false);
}

let contestantCounter = {{ saved_prefs.contestants|length if saved_prefs.contestants and saved_prefs.contestants|length > 0 else 2 }};

function addContestantBox() {
    contestantCounter++;
    const container = document.getElementById('contestant-inputs');
    const wrapper = document.createElement('div');
    wrapper.className = 'contestant-input-wrapper';
    wrapper.innerHTML = `
        <input type="text" name="contestants" class="contestant-input" placeholder="Contestant ${contestantCounter}">
        <button type="button" class="btn-remove-contestant" onclick="removeContestantBox(this)">×</button>
    `;
    container.appendChild(wrapper);
    updateRemoveButtons();
}

function removeContestantBox(button) {
    const container = document.getElementById('contestant-inputs');
    if (container.children.length > 2) {
        button.parentElement.remove();
        updateRemoveButtons();
    }
}

function updateRemoveButtons() {
    const container = document.getElementById('contestant-inputs');
    const removeButtons = container.querySelectorAll('.btn-remove-contestant');
    removeButtons.forEach(btn => {
        btn.style.display = container.children.length > 2 ? 'block' : 'none';
    });
}

function saveAndReturnToMain() {
    const form = document.querySelector('.options-form');
    const formData = new FormData(form);
    
    const tempForm = document.createElement('form');
    tempForm.method = 'POST';
    tempForm.action = '{{ url_for("vocab_save_settings") }}';
    
    const processedKeys = new Set();
    
    for (const [key, value] of formData.entries()) {
        if (processedKeys.has(key)) {
            continue;
        }
        
        processedKeys.add(key);
        
        const allValues = formData.getAll(key);
        
        if (allValues.length > 1) {
            allValues.forEach(val => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = val;
                tempForm.appendChild(input);
            });
        } else {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = value;
            tempForm.appendChild(input);
        }
    }
    
    document.body.appendChild(tempForm);
    tempForm.submit();
}

document.addEventListener('DOMContentLoaded', () => {
    updateRemoveButtons();
});
</script>
{% endblock %}
